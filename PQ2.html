<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>PQ2 Русификатор</title>
    <link rel="icon" href="PQ2_logo_light.png">
    <meta name="theme-color" content="#141414">
    <meta name="description"
        content="Русификатор Persona Q2: New Cinema Labyrinth.">

    <script src="deps/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="deps/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/common.css">
    <link rel="stylesheet" href="pq2/guide/style.css">
    <script src="assets/js/common.js"></script>
</head>

    <header id="header"><div class="headerWrap" id="headerItem">
        
            <div class="headerBox">
                <link rel="stylesheet" href="./pq2/common.min.css">
                    
                <h1 class="headerLogo">
                    <a href="https://ots.ottyss.ru/">
                    <img loading="lazy" src="./pq2/img/logo/logo.png" alt="">
                     </a>
                </h1>
            </div>
                
                <nav>
                    <div class="pcNavBox">

                        <ul class="pcNavList">
                            
                            <li class="pcNavItem is-news">
                                <a class="pageLinks" onclick="change_guide('instalacion'); return false;">
                                    <img loading="lazy" src="./pq2/img/menu-news.webp" alt="Установка">
                                </a>
                            </li>
                            
                            <li class="pcNavItem is-chara">
                                <a class="pageLinks" onclick="change_guide('extras'); return false;">
                                    <img loading="lazy" src="./pq2/img/menu-chara.webp" alt="Дополнительно">
                                </a>
                            </li>
                            
                            <li class="pcNavItem is-school">
                                <a class="pageLinks" onclick="change_guide('faq'); return false;">
                                    <img loading="lazy" src="./pq2/img/menu-schoollife.webp" alt="FAQ">
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
    </header>

<body class="bg-black bg_bg">
    
    
            <div class="video-container">
                <video autoplay loop muted playsinline class="background-video" preload="auto" poster="pq2/img/logo/PQ2_logo_light.png">
                    <source src="pq2/img/logo/pq2tr.mp4" type="video/mp4">
                </video>
            </div>

        <div class="row container mx-auto">
    
                <div class="container mt-2 p-4 bg_container mx-auto">
                    <div id="guide-content"></div>
                    <p class="javascript-disabled"></p>
                </div>




        <div class="credits-container mt-3 p-4 bg_container mx-auto">
<h3 class="text-center text-break"><b>Особая благодарность</b></h3>
<p class="text-center">Спасибо следующим людям и проектам за их прямую или косвенную помощь в этом переводе:</p>
            <div class="row hide-mobile3">
                <div class="col-md-6">
                    <ul>
<li><strong>TGE:</strong> <a href="https://github.com/tge-was-taken/Atlus-Script-Tools" target="_blank" class="text-decoration-none link-color">AtlusScriptTools</a></li>
<li><strong>ShrineFox:</strong> <a href="https://shrinefox.com/browse?post=pq2talkanimfix" target="_blank" class="text-decoration-none link-color">Исправление анимации разговоров.</a></li>
<li><strong>DeathChaos25:</strong> <a href="https://github.com/DeathChaos25/PQ_Patches" target="_blank" class="text-decoration-none link-color">PQ Patches</a>, <a href="https://github.com/DeathChaos25/PQ2PersonaNameTBL" target="_blank" class="text-decoration-none link-color">PQ2PersonaNameTBL</a></li>
<li><strong>Melonman19:</strong> <a href="https://github.com/Meloman19/PersonaEditor" target="_blank" class="text-decoration-none link-color">Persona Editor</a></li>
<li><strong>Pioziomgames:</strong> <a href="https://gamebanana.com/tools/8939" target="_blank" class="text-decoration-none link-color">Bam Editor</a></li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul>
<li><strong>hadashisora:</strong> <a href="https://github.com/hadashisora/NintyFont" target="_blank" class="text-decoration-none link-color">NintyFont</a></li>
<li><strong>ObsidianX:</strong> <a href="https://github.com/ObsidianX/3dstools" target="_blank" class="text-decoration-none link-color">3dstools</a></li>
<li><strong>Artur16211:</strong> <a href="https://github.com/Artur16211" target="_blank" class="text-decoration-none link-color">Помощь с текстом и сайтом</a></li>
<li><strong>FanTranslatorsInternational:</strong> <a href="https://github.com/FanTranslatorsInternational/Kuriimu2" target="_blank" class="text-decoration-none link-color">Kuriimu2</a></li>
<li><strong>MapStudioProject:</strong> <a href="https://github.com/MapStudioProject/CTR-Studio" target="_blank" class="text-decoration-none link-color">CTR Studio</a></li>
                    </ul>
                </div>
            </div>
            <div class="hide-desktop3 text-break">
                <ul>
<li><strong>TGE:</strong> <a href="https://github.com/tge-was-taken/Atlus-Script-Tools" target="_blank" class="text-decoration-none link-color">AtlusScriptTools</a></li>
<li><strong>ShrineFox:</strong> <a href="https://shrinefox.com/browse?post=pq2talkanimfix" target="_blank" class="text-decoration-none link-color">Исправление анимации разговоров и документация.</a></li>
<li><strong>DeathChaos25:</strong> <a href="https://github.com/DeathChaos25/PQ_Patches" target="_blank" class="text-decoration-none link-color">PQ Patches</a>, <a href="https://github.com/DeathChaos25/PQ2PersonaNameTBL" target="_blank" class="text-decoration-none link-color">PQ2PersonaNameTBL</a></li>
<li><strong>Melonman19:</strong> <a href="https://github.com/Meloman19/PersonaEditor" target="_blank" class="text-decoration-none link-color">Persona Editor</a></li>
<li><strong>Pioziomgames:</strong> <a href="https://gamebanana.com/tools/8939" target="_blank" class="text-decoration-none link-color">Bam Editor</a></li>
<li><strong>hadashisora:</strong> <a href="https://github.com/hadashisora/NintyFont" target="_blank" class="text-decoration-none link-color">NintyFont</a></li>
<li><strong>ObsidianX:</strong> <a href="https://github.com/ObsidianX/3dstools" target="_blank" class="text-decoration-none link-color">3dstools</a></li>
<li><strong>Artur16211:</strong> <a href="https://github.com/Artur16211" target="_blank" class="text-decoration-none link-color">Помощь с текстом и сайтом</a></li>
<li><strong>FanTranslatorsInternational:</strong> <a href="https://github.com/FanTranslatorsInternational/Kuriimu2" target="_blank" class="text-decoration-none link-color">Kuriimu2</a></li>
<li><strong>MapStudioProject:</strong> <a href="https://github.com/MapStudioProject/CTR-Studio" target="_blank" class="text-decoration-none link-color">CTR Studio</a></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // hide class for JS is disabled message
        const javascriptDisabledMessage = document.querySelector('.javascript-disabled');
        javascriptDisabledMessage.classList.add('d-none');
        //
        const creditsContainer = document.querySelector('.credits-container');

        function change_guide(guide, subsection = null) {
            let content = '';
            switch (guide) {
                case 'instalacion':
                    content = `
                        <h2 class="title3 text-break">Руководство по установке</h2>
                        <section class="mt-4">
                            <h2 class="title2 text-break">Требования</h2>
                            <p class="mb-3 fs-5">Для игры с Русификатором в Persona Q<span class="orange-text">2</span> понадобятся:</p>
                            <ul class="fs-5">
                            <li>Консоль <span class="red-text">2</span>DS/<span class="red-text">3</span>DS с CFW, таким как Luma3DS, или установленный эмулятор <span class="ct-text">3</span>DS на вашем устройстве.</li>
                            <li>Копия игры <b>региона USA</b>.</li>
                            </ul>
                            <hr>
                            <h2 class="title2 text-break">Загрузить</h2>
                            <h2 class="title1">GitHub:</h2>
                            <a href="https://github.com/OTTYSS/PQ2-Russian-translate/releases" target="_blank" class="btn btn-primary1 mt-2 border-5">GitHub <svg xmlns="http://www.w3.org/2000/svg" width="24" height="50" viewBox="0 0 24 24"><path fill="currentColor" d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-8 4v-5h2v3h12v-3h2v5z"/></svg></a>
                            <br>
                            <h2 class="title2 text-break hide-mobile3">Метод установки</h2>
                            <h2 class="title2 text-break hide-desktop3">Метод установки</h2>
                            <div class="border-explanation p-3">
                                <p class="mb-3 fs-5 fw-bold blue-text">Патч Рома:</p>
                                <p class="mb-3 fs-6">
                                Этот метод заключается в применении патча <b>xdelta</b> к файлу <b>.cia</b> 
                                <b class="text-break">расшифрованному</b> и <b>извлеченному с вашего картриджа</b>, создавая новый 
                                <b>.cia</b> с примененным переводом.<br>
                                </p>

                                <p class="mb-3 fs-5 fw-bold pink-text">LayerFS:</p>
                                <p class="mb-3 fs-6">
                                    Этот метод позволяет заменять файлы игры с помощью <b>LayerFS</b>, 
                                    не изменяя напрямую ROM.
                                </p>
                            </div>
                            <br>
                            <div class="text-center my-3">
                                <button class="btn btn-design btn-patch mx-2" id="patchrom_btn" onclick="change_method('parcheo')">Патч Рома</button>
                                <br class="hide-desktop"><br class="hide-desktop">
                                <button class="btn btn-design btn-layer mx-2" id="layerfs_btn" onclick="change_method('layerfs')">LayerFS</button>
                            </div>
                            <div id="method-content" class="p-3 fs-5 text-center">
                                <p>Выберите метод установки для продолжения.</p>
                            </div>
                        </section>
                    `;
                    creditsContainer.style.display = 'block';
                    break;
                case 'extras':
                    content = `
                        <h2 class='title3'>Дополнительно</h2>
                        <h4 class="mb-3 text-uppercase fw-bold"></h4>
                        
                        <!--
                        <section class="mt-4" id="alt-layout">
                            <h2 class="title2 fs-3 text-center">Add-on: A/B - X/Y</h2>
                            <p class="fs-5">Intercambia <b>A/B</b> y <b>X/Y</b>, requiere las <b>Texturas HD</b>.</p>
                            <br class="hide-desktop3">
                            <div class="accordion" id="accordionImagesAlt">
                        <!-- Batalla -->
                        <!--        
                                <div class="accordion-item bg-dark text-white border-accordion">
                                    <h2 class="accordion-header" id="headingFour">
                                        <button class="accordion-button text-white accordion-button-addon" type="button" data-bs-target="#collapseFour" aria-expanded="true" aria-controls="collapseFour">Batalla</button>
                                    </h2>
                                    <div id="collapseFour" class="accordion-collapse collapse show" aria-labelledby="headingFour" data-bs-parent="#accordionImagesAlt">
                                        <img src="pq2/img/addon/batalla.webp" alt="addon batalla" class="addon-img img-fluid" style="aspect-ratio: 5 / 3; width: 100%; object-fit: contain;">
                                    </div>
                                </div>
                            </div>
                            <br>
                            <a href="https://www.mediafire.com/file/34zgd88q2v4ekmf/PersonaQ2ES_Addon_AB-XY_Layout.7z/file" target="_blank" class="btn btn-primary mt-2 border-5">ADD-ON: A/B - X/Y<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-8 4v-5h2v3h12v-3h2v5z"/>
                                </svg>
                            </a>
                        </section>
                         --> 
                        <hr>
                        <section class="mt-4" id="pqpatches">
                        <h2 class="title2">PQ Патчи</h2>
                        <p class="fs-5">Эти патчи, созданные <a href="https://github.com/DeathChaos25" target="_blank" class="text-decoration-none link-color">DeathChaos25</a>, позволяют отображать <span class="text-secondary">"каноничные"</span> имена персонажей и активировать <span class="text-secondary">поддержку модов</span> через файл <code>mod.cpk</code> с помощью <a class="pink-text text-decoration-none">LayerFS</a>.<br><br>Вы можете установить их, следуя инструкциям на его <a class="text-decoration-none link-color" href="https://github.com/DeathChaos25/PQ_Patches" target="_blank">репозитории на GitHub</a>
                <!--  или скачать файлы <code>code.bin</code> и <code>exheader.bin</code>, уже <b>предварительно запатченные на испанский</b> по следующим ссылкам.</p>
                        <h2 class="title">Скачивания:</h2>
                        <a href="https://www.mediafire.com/folder/92r7usmlwc0xy/ModCPK" class="btn btn-primary mt-2 border-5" target="_blank">Версия с <b>поддержкой MOD.CPK</b> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-8 4v-5h2v3h12v-3h2v5z"/></svg></a>
                        <br>
                        <a href="https://www.mediafire.com/folder/pbta1djdhcxl2/ModCPK_CanonNames" class="btn btn-primary mt-2 border-5" target="_blank">Версия с <b>поддержкой MOD.CPK</b> и <b>каноничными именами</b> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-8 4v-5h2v3h12v-3h2v5z"/></svg></a>
                        <br>
                        <p class="fs-6 border-explanation2 p-3">Если вы установили перевод с использованием метода <a class="blue-text text-decoration-none">Патчинг ROM</a> и хотите использовать <b>каноничные имена</b>, необходимо поместить <b>пустой mod.cpk</b> в папку <code>luma/titles/00040000001D7100/romfs/</code> на вашей <b class="red-text">консоли</b> или в папку <code>load/mods/00040000001D7100/romfs/</code> вашего <b class="ct-text">эмулятора</b>.</p>
                        <a href="https://www.mediafire.com/file/680rr12mc4rr19v/mod.cpk/file" class="btn btn-primary3 mt-2 border-5" target="_blank"><b>Пустой MOD.CPK</b> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-8 4v-5h2v3h12v-3h2v5z"/></svg></a>
                    </section>
                -->
                    `;
                    creditsContainer.style.display = 'none';
                    break;
                case 'faq':
                    content = `<h2 class='title3 text-break'>FAQ <br></h2>
                    <h2 class="title1">Как я могу сообщить об ошибке?</h2>
                    <p class="fs-6">
                        Ознакомьтесь с разделом
                        <a href="#" onclick="event.preventDefault(); change_guide('faq', 'errores-conocidos')" class="text-decoration-none link-color"><b>известных ошибках</b></a> и остальной частью этой страницы.
                        Если вы не найдете свою проблему, вы можете связаться со мной написав в комментариях <a href="https://t.me/otspq" target="_blank" class="text-decoration-none link-color">здесь</a>.
                    </p>

                    </p>
                    <br>
                    <h2 class="title1">Совместимость перевода с DLC</h2>
                    <p class="fs-6">Да, перевод совместим со всеми DLC игры.</p>
                    <br>
                    <h2 class="title1">Совместимость перевода с европейской/японской версией игры</h2>
                    <p class="fs-6">Нет, на данный момент перевод совместим только с версией игры для США, но возможно в будущем будет добавлена поддержка версии для EUR.</p>
                    <br>
                    <h2 class="title1">Программа для патчей xdelta говорит, что мой ROM некорректен.</h2>
                    <p class="fs-6">Это происходит, когда ROM (.cia), извлечённая с вашего картриджа, имеет другой контрольный код, чем ожидалось. Файл .cia должен иметь <b>MD5</b> <code class="text-break">F80799B298DC69F32863DFC20BE9346D</code>. Хотя это не должно происходить, вы можете попробовать сделать патч, отключив проверку контрольной суммы в вашей программе для патчей (но это не гарантирует успех).</p>
                    <br>
                    <!--
                    <h2 class="title1">Шрифт в текстурах не HD?</h2>
                    <p class="fs-6">Шрифт игры не может быть масштабирован, поэтому его качество невозможно улучшить.</p>
                    <br>
                    -->
                    <h2 class="title1">Совместимость перевода с модами</h2>
                    <p class="fs-6">Да, перевод совместим с другими модами, но не гарантируется, что содержимое этих модов будет переведено.</p>
                    <p class="fs-6">Вы можете получить версию <b>Mod Compendium</b> перевода <a href="https://github.com/OTTYSS/PQ2-Russian-translate" target="_blank" class="text-decoration-none link-color">здесь</a>.</p>
                    <br>
                    <h2 class="title1">Совместимость перевода с Android</h2>
                    <p class="fs-6">Да, перевод совместим с Android, но вам потребуется эмулятор 3DS на вашем устройстве и нужно будет следовать инструкциям по установке на этой странице.</p>
                    <br>
                    <!--
                    <h2 class="title1">HD текстуры совместимы с Android?</h2>
                    <p class="fs-6">Да, HD текстуры совместимы с Android, вы можете следовать инструкциям по установке в разделе Дополнительно.</p>
                    <br>
                    -->
                    <h2 class="title1">Игра работает, но зависает после диалога.</h2>
                    <p class="fs-6">Это происходит в некоторых эмуляторах, когда включен режим "New 3DS" в настройках эмулятора. Отключите эту опцию, чтобы решить проблему.</p>
                    <hr>

                    <h2 class="title3 text-break" id="errores-conocidos">Известные ошибки</h2>
                    <ul>
                        <li>
                        <h2 class="title1">Некоторые названия объектов, персонажей и/или умений содержат странные символы.</h2>
                        <p class="fs-6">Это связано с ошибкой памяти игры, не влияет на игровой процесс и происходит случайным образом, обычно устраняется со временем при игре и/или перезапуске игры.</p>
                        <br> 
                        <li>
                        <h2 class="title1">Иногда встречаются английские/японские символы</h2>
                        <p class="fs-6">Напишите в тг канал или группу вконтакте с скриншотом места.</p>
                        <br>
                        <h2 class="title1">При игре на 3DS заставки не работают</h2>
                        <p class="fs-6">Знаю, пофикшу.</p>
                         <!--
                        <!--
                        <li>
                            <h2 class="title1">Атака Союза Хару и Юкико не переведена.</h2>
                            <p class="fs-6">На данный момент перевести её невозможно.</p>
                        </li>
                        -->
                    </ul>
                    `;
                    creditsContainer.style.display = 'none';
                    break;
            }
            document.getElementById('guide-content').innerHTML = content;

            // slider
            // Función para inicializar un comparador
            function initComparator(comparator) {
                const afterImage = comparator.querySelector('.image-after');
                const slider = comparator.querySelector('.slider');

                let isDragging = false;

                // Restaurar la posición del slider si existe
                const savedPosition = comparator.getAttribute('data-slider-position');
                if (savedPosition) {
                    afterImage.style.clipPath = `inset(0 0 0 ${savedPosition}%)`;
                    slider.style.left = `${savedPosition}%`;
                }

                // Función para actualizar la posición del slider
                function updateSliderPosition(clientX) {
                    const rect = comparator.getBoundingClientRect();
                    let xPosition = clientX - rect.left;
                    let percentage = (xPosition / rect.width) * 100;

                    // Limitar entre 0 y 100
                    percentage = Math.max(0, Math.min(percentage, 100));

                    // Actualizar el clip-path y la posición del slider
                    afterImage.style.clipPath = `inset(0 0 0 ${percentage}%)`;
                    slider.style.left = `${percentage}%`;

                    // Guardar la posición actual del slider
                    comparator.setAttribute('data-slider-position', percentage);
                }

                // Eventos de ratón
                slider.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    e.preventDefault(); // Evita que se seleccione el contenido
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) updateSliderPosition(e.clientX);
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                // Eventos táctiles (móviles)
                slider.addEventListener('touchstart', (e) => {
                    isDragging = true;
                    e.preventDefault(); // Evita el desplazamiento de la pantalla
                });

                document.addEventListener('touchmove', (e) => {
                    if (isDragging) {
                        updateSliderPosition(e.touches[0].clientX);
                    }
                });

                document.addEventListener('touchend', () => {
                    isDragging = false;
                });
            }

            // Inicializar los comparadores
            const comparators = document.querySelectorAll('.image-comparator');
            comparators.forEach(comparator => {
                initComparator(comparator);
            });

            // Guardar el estado del slider antes de colapsar el acordeón
            document.querySelectorAll('.accordion-button').forEach(button => {
                button.addEventListener('click', () => {
                    const collapse = button.closest('.accordion-item').querySelector('.accordion-collapse');
                    if (collapse.classList.contains('show')) {
                        // Guardar el estado del slider antes de colapsar
                        const comparator = collapse.querySelector('.image-comparator');
                        if (comparator) {
                            const sliderPosition = comparator.querySelector('.slider').style.left;
                            comparator.setAttribute('data-slider-position', parseFloat(sliderPosition));
                        }
                    }
                });
            });
            // slider


            // Actualizar el hash con la sección y subsección
            if (subsection) {
                window.location.hash = `#${guide}&section=${subsection}`;
            } else {
                window.location.hash = `#${guide}`;
            }

            // Desplazarse a la subsección después de cargar el contenido
            if (subsection) {
                setTimeout(() => {
                    const element = document.getElementById(subsection);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 100);
            }

            // Actualizar el estado de los botones
            const buttons = document.querySelectorAll('.btn-guide');
            buttons.forEach(button => {
                if (button.id === `guide-${guide}`) {
                    button.classList.remove('disabled-guide');
                } else {
                    button.classList.add('disabled-guide');
                }
            });

            // Actualizar el estado de los botones
            const buttons2 = document.querySelectorAll('.btn-guide-mobile');
            buttons2.forEach(button => {
                if (button.id === `guide-${guide}`) {
                    button.classList.remove('disabled-guide');
                } else {
                    button.classList.add('disabled-guide');
                }
            });

            if (guide == 'extras' || guide == 'faq') {
                localStorage.removeItem('selectedDevice');
                localStorage.removeItem('selectedMethod');
                // console.log('Removed saved device and method');
            }
        }

        function loadSectionFromHash() {
            const hash = window.location.hash.substring(1);
            const parts = hash.split('&');
            let guide = parts[0];
            let subsection = null;

            // Si no hay hash, establecer guía por defecto
            if (!guide) {
                guide = 'instalacion';
            }

            // Extraer subsección si existe
            if (parts.length > 1) {
                const sectionParam = parts.find(part => part.startsWith('section='));
                if (sectionParam) {
                    subsection = sectionParam.split('=')[1];
                }
            }

            if (['instalacion', 'extras', 'faq'].includes(guide)) {
                change_guide(guide, subsection);
            }

            const savedDevice = localStorage.getItem('selectedDevice');
            const savedMethod = localStorage.getItem('selectedMethod');

            if (guide !== 'extras' || guide !== 'faq' || guide == null) {
                if (savedMethod == 'parcheo') {
                    document.getElementById('patchrom_btn').click();
                }
            }

            if (savedDevice) {
                if (guide !== 'extras' || guide !== 'faq' || guide == null) {
                    //setTimeout(() => {
                    document.getElementById('layerfs_btn').click(); // Activar botón de LayerFS

                    // console.log('Loaded selected device:', savedDevice);
                    document.querySelector(`.btn-${savedDevice}`).click(); // Activar botón de dispositivo guardado
                    //}, 100);
                }
            }
        }

        $(document).ready(function () {
            // Cargar sección al inicio
            loadSectionFromHash();

            // Escuchar cambios en el hash (navegación manual o con botones atrás/adelante)
            $(window).on('hashchange', function () {
                loadSectionFromHash();
            });
        });

        let activeMethod = null;

        function change_method(method) {

            // disable method if already active
            if (activeMethod === method) {
                //console.log('esto se ejecuta');
                document.getElementById('method-content').innerHTML = '<p>Выберите метод установки для продолжения.</p>';
                document.getElementById('patchrom_btn').classList.remove('active-btn');
                document.getElementById('layerfs_btn').classList.remove('active-btn');
                activeMethod = null;
                // delete saved device/method from local storage
                localStorage.removeItem('selectedDevice');
                localStorage.removeItem('selectedMethod');
                return;
            }

            activeMethod = method;

            let content = '';
            if (method === 'layerfs') {
                localStorage.removeItem('selectedMethod');
                document.getElementById('layerfs_btn').classList.add('active-btn');
                document.getElementById('patchrom_btn').classList.remove('active-btn');
                content = `
                    <h2 class='text-center'>LayerFS</h2>
                    <div class="text-start fw-bold">Шаг 1:</div>
                    <p class="text-start">Скачайте патч перевода в формате <a class="pink-text text-decoration-none">LayerFS (mod.cpk)</a>.</p>
                    <hr>
                    <div class="text-start fw-bold">Шаг 2:</div>
                    <p class="text-start">Скачайте <a class="text-decoration-none text-white" href="#" onclick="change_guide('extras'); setTimeout(function(){ document.getElementById('pqpatches').scrollIntoView({ behavior: 'smooth' }); }, 300); return false;"><b>PQ Patches</b></a> (<code>code.bin</code> и <code>exheader.bin</code>), чтобы загрузить перевод из <a class="pink-text text-decoration-none">mod.cpk</a> в разделе <a class="text-decoration-none link-color" href="#" onclick="change_guide('extras'); setTimeout(function(){ document.getElementById('pqpatches').scrollIntoView({ behavior: 'smooth' }); }, 300); return false;">Дополнительно</a>.</p>
                    <div class='text-center my-3'>
                        <div class='row'>
                            <div class='col-lg-4'>
                                <button class='btn btn-console btn-design w-100' onclick='change_device("console")'>Консоль (<span class="red-text">2</span>DS/<span class="red-text">3</span>DS)</button>
                                <br class="hide-desktop2"><br class="hide-desktop2">
                            </div>
                            <div class='col-lg-4'>
                                <button class='btn btn-android btn-design w-100' onclick='change_device("android")'>Android</button>
                                <br class="hide-desktop2"><br class="hide-desktop2">
                            </div>
                            <div class='col-lg-4'>
                                <button class='btn btn-pc btn-design w-100' onclick='change_device("pc")'>PC</button>
                            </div>
                        </div>
                    </div>
                    <div id='content-device' class='p-3'>
                        <p>Выберите метод установки для продолжения.</p>
                    </div>
                `;
            } else if (method === 'parcheo') {
                localStorage.removeItem('selectedDevice');
                // console.log('set method:', method);
                localStorage.setItem('selectedMethod', 'parcheo');
                // console.log('Removed saved device');
                //
                document.getElementById('patchrom_btn').classList.add('active-btn');
                document.getElementById('layerfs_btn').classList.remove('active-btn');
                content = `<h2 class='text-center'>Патч Рома</h2>
                    <div class="text-start fw-bold">Шаг 1:</div>
                    <p class="text-start">Скачайте патч перевода в формате <a class="blue-text text-decoration-none">Патч (xdelta)</a>.</p>
                    <hr>
                    <div class="text-start fw-bold">Шаг 2:</div>
                    <p class="text-start">С выключенной консолью удерживайте кнопку <code class="console-btn">START</code> и включите её, чтобы попасть в меню <b>GodMode9</b>.</p>
                    <p class="text-start">В этом меню выберите картридж Persona Q<a class="orange-text text-decoration-none">2</a> "<b>GAMECART (CTR9002F0C2)</b>" и нажмите <code class="console-btn btn-a">A</code>.</p>
                    <img src="pq2/img/tutorial_patch/gm9/root_1.webp" alt="Paso 1" class="img img-fluid tutorial-img tutorial-img-android" style="aspect-ratio: 5 / 3; width: 100%; object-fit: contain;">
                    <hr>
                    <div class="text-start fw-bold mt-3">Шаг 3:</div>
                    <p class="text-start mb-3">Выберите формат <b class="text-break">00040000001D7100_v00.trim.3ds</b> и нажмите <code class="console-btn btn-a">A</code>.</p>
                    <img src="pq2/img/tutorial_patch/gm9/c_2.webp" alt="Paso 2" class="img img-fluid tutorial-img tutorial-img-android" style="aspect-ratio: 5 / 3; width: 100%; object-fit: contain;">
                    <hr>
                   <div class="text-start fw-bold mt-3">Шаг 4:</div>
                    <p class="text-start mb-3">Выберите <b>NCSD image options...</b></p>
                    <img src="pq2/img/tutorial_patch/gm9/top_1.webp" alt="Paso 3" class="img img-fluid tutorial-img tutorial-img-android" style="aspect-ratio: 5 / 6; width: 100%; object-fit: contain;">
                    <hr>
                    <div class="text-start fw-bold mt-3">Шаг 5:</div>
                    <p class="text-start mb-3">Выберите <b>Build CIA from file</b>.</p>
                    <img src="pq2/img/tutorial_patch/gm9/top_2.webp" alt="Paso 4" class="img img-fluid tutorial-img tutorial-img-android" style="aspect-ratio: 5 / 6; width: 100%; object-fit: contain;">
                    <hr>
                    <div class="text-start fw-bold mt-3">Шаг 6:</div>
                    <p class="text-start mb-3">Подождите, пока процесс завершится, и нажмите <code class="console-btn btn-a">A</code> для продолжения.</p>
                    <img src="pq2/img/tutorial_patch/gm9/top_3.webp" alt="Paso 5" class="img img-fluid tutorial-img tutorial-img-android" style="aspect-ratio: 5 / 6; width: 100%; object-fit: contain;">
                    <hr>
                    <div class="text-start fw-bold mt-3">Шаг 7:</div>
                    <p class="text-start mb-3">Подключите вашу SD-карту к компьютеру и в папке <b>gm9/out</b> скопируйте файл <b class="text-break">00040000001D7100_v00.trim.standard.cia</b>.</p>

                    <img src="pq2/img/tutorial_patch/SD.webp" alt="Paso 6" class="img img-fluid tutorial-img tutorial-img-android" style="aspect-ratio: 54 / 19; width: 100%; object-fit: contain;">
                    <div class="text-start fw-bold mt-3">Шаг 8:</div>
                    <p class="text-start mb-3">Скачайте программу для применения патчей <b>xdelta</b>, например, <a href="https://www.romhacking.net/utilities/704/" target="_blank" class="text-decoration-none link-color">Delta Patcher</a>, чтобы применить уже скачанный <a class="blue-text text-decoration-none">патч</a>.</p>
                    <hr>
                    <div class="text-start fw-bold mt-3">Шаг 9:</div>
                    <p class="text-start mb-3">Откройте программу, выберите файл <b class="text-break">00040000001D7100_v00.trim.standard.cia</b> как <b>Оригинальный файл</b> и патч перевода как <b>XDelta патч</b>.</p>
                    <img src="pq2/img/tutorial_patch/Delta.webp" alt="Paso 8" class="img img-fluid tutorial-img tutorial-img-android" style="aspect-ratio: 265 / 249; width: 100%; object-fit: contain;">
                    <hr>
                    <div class="text-start fw-bold mt-3">Шаг 10:</div>
                    <p class="text-start mb-3">Примените патч, и ваш оригинальный файл .cia будет заменен. Это будет ваша ROM с примененным переводом, готовая для установки на вашу консоль или эмулятор.</p>

                `;
            }
            document.getElementById('method-content').innerHTML = content;
        }

        function change_device(type) {
            localStorage.setItem('selectedDevice', type);
            // console.log('Saved selected device:', type);

            let content = '';
            switch (type) {
                case 'console':
                    content = `
                        <hr>
                        <div class="text-start fw-bold">Шаг 3:</div>
                        <p class="text-start">
                            С выключенной консолью, удерживайте кнопку <code class="console-btn">SELECT</code> и включите её, чтобы попасть в меню Luma3DS.
                        </p>
                        <p class="text-start">
                            В этом меню активируйте опцию <strong>"Enable game patching"</strong>, а затем нажмите <strong>"Save and exit"</strong>.
                        </p>
                        <img src="pq2/img/tutorial_cpk/console/1.webp" alt="Paso 3" class="img img-fluid tutorial-img" style="aspect-ratio: 100 / 61; width: 100%; object-fit: contain;">
                        <hr>
                        <div class="text-start fw-bold mt-3">Шаг 4:</div>
                        <p class="text-start">
                            Извлеките карту памяти из вашей консоли, вставьте её в компьютер и скопируйте следующие файлы в папку <code>luma/titles/00040000001D7100</code>:
                        </p>
                        <ul class="text-start">
                            <li>В корневую папку <code>00040000001D7100</code>: поместите файлы <code>code.bin</code> и <code>exheader.bin</code>.</li>
                            <li>В подкаталог с названием <code>romfs</code>: поместите файл <code>mod.cpk</code>.</li>
                        </ul>
                        <img src="pq2/img/tutorial_cpk/console/2.webp" alt="Paso 4" class="img img-fluid tutorial-img" style="aspect-ratio: 233 / 84; width: 100%; object-fit: contain;"><br><br>
                        <img src="pq2/img/tutorial_cpk/console/3.webp" alt="Paso 4" class="img img-fluid tutorial-img" style="aspect-ratio: 233 / 54; width: 100%; object-fit: contain;">
                    `;
                    break;
                case 'android':
                    content = `
                        <hr>
                        <div class="text-start fw-bold">Шаг 3:</div>
                        <p class="text-start">
                            Открой проводник файлов на своем устройстве и найди папку с твоим эмулятором <span class="ct-text">3</span>DS.
                        </p>

                        <img src="pq2/img/tutorial_cpk/Android/1.webp" alt="Paso 3" class="img img-fluid tutorial-img-android" style="aspect-ratio: 524 / 599; width: 100%; object-fit: contain;">
                        <hr>
                        <div class="text-start fw-bold mt-3">Шаг 4:</div>
                        <p class="text-start">
                            После этого перейди в папку <code class="text-break">load/mods/00040000001D7100</code>. 
                            Если папка не существует, создай её вручную.
                        </p>

                        <img src="pq2/img/tutorial_cpk/Android/2.webp" alt="Paso 4" class="img img-fluid tutorial-img-android" style="aspect-ratio: 527 / 375; width: 100%; object-fit: contain;"><br><br>
                        <img src="pq2/img/tutorial_cpk/Android/3.webp" alt="Paso 4" class="img img-fluid tutorial-img-android" style="aspect-ratio: 522 / 159; width: 100%; object-fit: contain;">
                        <hr>
                        <div class="text-start fw-bold mt-3">Шаг 5:</div>
                        <p class="text-start">
                            Внутри папки <code class="text-break">00040000001D7100</code> создай две новые папки с названиями 
                            <code>romfs</code> и <code>exefs</code>.
                        </p>

                        <img src="pq2/img/tutorial_cpk/Android/4.webp" alt="Paso 5" class="img img-fluid tutorial-img-android" style="aspect-ratio: 531 / 271; width: 100%; object-fit: contain;">
                        <hr>
                        <div class="text-start fw-bold mt-3">Шаг 6:</div>
                            <p class="text-start">
                                Помести следующие файлы в соответствующие папки:
                            </p>
                            <ul class="text-start">
                                <li><b>exefs</b>: Помести файл <code>code.bin</code>.</li>
                                <li><b>romfs</b>: Помести файл <code>mod.cpk</code>.</li>
                                <li>В корневую папку <code>/00040000001D7100</code>: Помести файл <code>exheader.bin</code>.</li>
                            </ul>
                        <img src="pq2/img/tutorial_cpk/Android/5.webp" alt="Paso 6" class="img img-fluid tutorial-img-android" style="aspect-ratio: 531 / 177; width: 100%; object-fit: contain;"><br><br>
                        <img src="pq2/img/tutorial_cpk/Android/6.webp" alt="Paso 6" class="img img-fluid tutorial-img-android" style="aspect-ratio: 525 / 168; width: 100%; object-fit: contain;"><br><br>
                        <img src="pq2/img/tutorial_cpk/Android/7.webp" alt="Paso 6" class="img img-fluid tutorial-img-android" style="aspect-ratio: 531 / 370; width: 100%; object-fit: contain;">
                    `;
                    break;
                case 'pc':
                    content = `
                    <hr>
                    <div class="text-start fw-bold">Шаг 3:</div>
                    <p class="text-start">
                    Открой свой эмулятор <span class="ct-text">3</span>DS и щелкни правой кнопкой мыши на игре 
                    <strong>Persona Q2</strong>. 
                    Затем открой подменю <strong>"Open"</strong> и выбери <strong>"Mods Location"</strong>.
                    </p>
                    <img src="pq2/img/tutorial_cpk/pc/2.webp" alt="Paso 3" class="img img-fluid tutorial-img" style="aspect-ratio: 811 / 425; width: 100%; object-fit: contain;">
                    <hr>
                    <div class="text-start fw-bold mt-3">Шаг 4:</div>
                    <p class="text-start">
                        В открывшейся папке помести следующие файлы в соответствующие места:
                    </p>
                    <ul class="text-start">
                        <li><b>exefs</b>: Вставь файл <code>code.bin</code>.</li>
                        <li><b>romfs</b>: Вставь файл <code>mod.cpk</code>.</li>
                        <li>В корень папки: Вставь файл <code>exheader.bin</code>.</li>
                    </ul>
                    <img src="pq2/img/tutorial_cpk/pc/3.webp" alt="Paso 4" class="img img-fluid tutorial-img" style="aspect-ratio: 399 / 173; width: 100%; object-fit: contain;">
                    `;
                    break;
                default:
                    break;
            }
            document.getElementById('content-device').innerHTML = content;

            document.querySelectorAll('.btn-design').forEach(btn => {
                btn.classList.remove('active-btn');
            });

            document.getElementById('layerfs_btn').classList.add('active-btn');
            document.getElementById('patchrom_btn').classList.remove('active-btn');
            document.querySelector(`.btn-${type}`).classList.add('active-btn');
        }

    </script>

    <footer class="footer mt-3 hide-desktop3">
        <div class="container mt-4">
            <div class="row mb-5">
                <div class="col-12 text-center">
                    <a class="logo-link" href="">
                        <img src="pq2\img\logo\logo.png" alt="Logo" class="logofooter"
                            style="width: 200px;">
                    </a>
                </div>
                <div class="col-md-4">
                    <br>
                </div>
                <div class="col-md-4 mt-3">
                    <p class="text-white text-center">Этот проект не связан с ATLUS или SEGA. 
                        Все права принадлежат их соответствующим владельцам.</p>
                </div>
            </div>
        </div>
    </footer>
    <footer class="footer mt-3 hide-mobile3">
        <div class="container mt-4">
            <div class="row mb-5">
                <div class="col-md-4">
                    <a class="logo-link w-25" href="">
                        <img src="pq2\img\logo\logo.png" alt="Logo" class="logofooter"
                            style="width: 200px;">
                    </a>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-4">
                    <p class="text-white text-center">Этот проект не связан с ATLUS или SEGA. 
                        Все права принадлежат их соответствующим владельцам.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <script src="deps/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="deps/iconify.min.js"></script>
</body>

</html>